global
  log /dev/log local0
  daemon

defaults
  mode http
  log global
  option httplog
  option forwardfor
  timeout connect 5s
  timeout client 50s
  timeout server 50s

# Panel de stats (recuerda NO exponerlo públicamente si no hace falta)
listen stats
  bind *:9000
  stats enable
  stats uri /
  stats refresh 10s
  stats auth admin:admin

# Resolver DNS de Docker dentro del contenedor
resolvers docker_resolver
  nameserver docker 127.0.0.11:53
  resolve_retries 3
  timeout retry 1s
  hold valid 10s

frontend http_front
  bind *:8080
  default_backend be_front

backend be_front
  balance roundrobin
  # Healthcheck HTTP (ajusta a / si no tienes /health)
  option httpchk GET /
  http-check expect status 200

  # Descubre hasta 1-5 réplicas del servicio 'front' en Swarm
  # Si escalas más, sube el rango (p.ej. 1-10)
  server-template front- 1-5 tasks.front:80 check resolvers docker_resolver resolve-prefer ipv4 init-addr libc,none
